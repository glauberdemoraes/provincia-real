â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                 COCKPIT PROVINCIA REAL â€” MIGRAÃ‡ÃƒO DO BANCO DE DADOS             â•‘
â•‘                                                                                 â•‘
â•‘                           STATUS: â³ PRONTO PARA EXECUTAR                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ ARQUIVO PRONTO PARA COPIAR:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  LocalizaÃ§Ã£o: /root/aios-workspace/provincia-real/supabase/MIGRATIONS_COMBINED.sql
  Tamanho:     401 linhas, 20 KB
  Tempo:       ~30 segundos para executar

ğŸš€ INSTRUÃ‡Ã•ES RÃPIDAS (2 MINUTOS):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  1. Abra no seu navegador:
     https://supabase.com/dashboard/project/prnshbkblddfgttsgxpt/sql/new

  2. Copie TODO o conteÃºdo de:
     supabase/MIGRATIONS_COMBINED.sql

  3. Cole no editor do Supabase e clique "RUN" (Ctrl+Enter)

  4. Aguarde 30 segundos (deve dizer "Query executed successfully")

  5. Pronto! âœ¨

âœ… VALIDAR APÃ“S EXECUÃ‡ÃƒO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  OpÃ§Ã£o 1 (Manual): No SQL Editor, rode:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ SELECT table_name FROM information_schema.tables             â”‚
  â”‚ WHERE table_schema = 'public' ORDER BY table_name;          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Deve retornar 5 tabelas:
  â€¢ orders_cache âœ…
  â€¢ meta_campaigns_cache âœ…
  â€¢ alerts_config âœ…
  â€¢ active_alerts âœ…
  â€¢ sync_logs âœ…

  OpÃ§Ã£o 2 (AutomÃ¡tico): No seu terminal:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ cd provincia-real                                           â”‚
  â”‚ npx ts-node validate-migrations.ts                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š O QUE SERÃ CRIADO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ“ 2 Tabelas de Cache (para nÃ£o sobrecarregar APIs)
    â€¢ orders_cache (pedidos do NuvemShop)
    â€¢ meta_campaigns_cache (campanhas do Meta Ads)

  âœ“ 3 Tabelas de Suporte
    â€¢ alerts_config (7 regras de alerta padrÃ£o)
    â€¢ active_alerts (alertas disparados)
    â€¢ sync_logs (histÃ³rico de sincronizaÃ§Ãµes)

  âœ“ 4 FunÃ§Ãµes SQL
    â€¢ check_alerts() - avalia todas as 7 regras
    â€¢ sync_orders_to_cache() - puxa pedidos
    â€¢ sync_meta_to_cache() - puxa campanhas
    â€¢ extract_utm_param() - parseia URLs

  âœ“ 4 Views Analytics (para Dashboard)
    â€¢ daily_sales_summary - vendas por dia
    â€¢ utm_performance_summary - conversÃµes por canal
    â€¢ customer_ltv_summary - clientes recorrentes
    â€¢ hourly_order_velocity - pedidos por hora

  âœ“ 7 Regras de Alertas (seed automÃ¡tico)
    1. Ritmo abaixo do alvo (< 70%) âš ï¸
    2. Ritmo crÃ­tico (< 40%) ğŸš¨
    3. ROAS muito baixo (< 2.0x) âš ï¸
    4. ROAS crÃ­tico (< 1.0x) ğŸš¨
    5. CPA muito alto (> R$ 50) âš ï¸
    6. Nenhum pedido na hora (< 0.5/hr) â„¹ï¸
    7. Gasto Meta alto (> USD 200) âš ï¸

ğŸ” SEGURANÃ‡A:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ“ Row Level Security (RLS) habilitado
    â€¢ Apenas cliente anon pode ler dados de cache
    â€¢ Apenas functions podem escrever (protegidas)
    â€¢ Admin pode gerenciar

  âš ï¸ TOKENS AINDA HARDCODED (serÃ¡ migrado para Vault)
    â€¢ NuvemShop token em fetch_nuvemshop_orders()
    â€¢ Meta token em fetch_meta_campaigns()
    â€¢ Usar Vault depois para seguranÃ§a adicional

ğŸ“ TROUBLESHOOTING:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âŒ "Relation 'orders_cache' already exists"
     â†’ Tudo bem! Significa que as migraÃ§Ãµes jÃ¡ foram aplicadas

  âŒ "syntax error at end of input"
     â†’ VocÃª colou apenas parte do arquivo. Copie TODO o conteÃºdo

  âŒ "Query executed successfully" MAS ainda recebo erros
     â†’ Recarregue a pÃ¡gina do dashboard (Ctrl+Shift+R)

ğŸ¯ PRÃ“XIMAS ETAPAS (apÃ³s migraÃ§Ãµes):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  1. Verificar Dashboard
     https://provincia-real.vercel.app/dashboard
     â†’ Status bar deve mostrar "DB: Connected"

  2. Testar Alertas
     https://provincia-real.vercel.app/settings
     â†’ DeverÃ¡ carregar as 7 regras padrÃ£o

  3. Integrar Dados Originais
     â†’ Migrar cÃ³digo do App.tsx original
     â†’ Conectar componentes aos dados do cache

  4. Completar Funcionalidades
     â†’ PÃ¡gina Realtime (TV mode com auto-refresh 30s)
     â†’ PÃ¡gina History (tendÃªncias e LTV)
     â†’ SincronizaÃ§Ã£o de dados via UI

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DÃšVIDAS? Verifique o arquivo completo em:
  â†’ RUN_MIGRATIONS.md (instruÃ§Ãµes detalhadas com screenshots)

PRECISA VALIDAR? Execute:
  â†’ npx ts-node validate-migrations.ts (verificaÃ§Ã£o automÃ¡tica)

STATUS ATUAL:
  âœ… React app pronto em https://provincia-real.vercel.app
  âœ… Banco de dados estrutura pronta
  âœ… Arquivo de migraÃ§Ã£o pronto para copiar
  â³ Aguardando: ExecuÃ§Ã£o manual no SQL Editor

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
